<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>深渊信号</title>
    <style>
      /* --- 1. 基础样式 (复古终端风格) --- */
      :root {
        --bg-color: #050510; /* 深海黑蓝 */
        --text-color: #64ffda; /* 荧光青 */
        --dim-color: #2c4f4f; /* 暗淡色 */
        --alert-color: #ff5555; /* 警告红 */
        --font-main: "Courier New", Courier, monospace;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--font-main);
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden; /* 禁止整体滚动 */
      }

      /* --- 2. 顶部资源栏 --- */
      #status-bar {
        padding: 15px;
        border-bottom: 1px solid var(--dim-color);
        display: flex;
        justify-content: space-between;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10;
      }
      .resource {
        font-weight: bold;
      }
      .hidden {
        display: none !important;
      }

      /* --- 3. 中间日志区 (核心叙事) --- */
      #log-container {
        flex-grow: 1;
        padding: 20px;
        overflow-y: auto; /* 允许内部滚动 */
        display: flex;
        flex-direction: column-reverse; /* 新消息在最上方，或者最下方，这里选最上方符合手游习惯 */
        mask-image: linear-gradient(
          to bottom,
          black 80%,
          transparent 100%
        ); /* 底部渐隐效果 */
      }

      .log-entry {
        margin-bottom: 12px;
        line-height: 1.4;
        opacity: 0;
        animation: fadeIn 0.5s forwards;
        border-left: 2px solid var(--dim-color);
        padding-left: 10px;
      }
      .log-entry.new {
        border-left-color: var(--text-color);
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      /* --- 4. 底部操作区 --- */
      #controls {
        padding: 20px;
        background: rgba(5, 5, 16, 0.95);
        border-top: 1px solid var(--dim-color);
        min-height: 150px;
        display: grid;
        grid-template-columns: 1fr 1fr; /* 两列布局 */
        gap: 10px;
      }

      button {
        background: transparent;
        border: 1px solid var(--text-color);
        color: var(--text-color);
        padding: 15px;
        font-family: var(--font-main);
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        text-align: left;
        border-radius: 4px;
      }

      button:active {
        background: var(--text-color);
        color: var(--bg-color);
      }
      button:disabled {
        border-color: var(--dim-color);
        color: var(--dim-color);
        cursor: not-allowed;
      }

      /* 全屏宽按钮 */
      .btn-full {
        grid-column: span 2;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div id="status-bar">
      <span id="res-power" class="resource hidden">电力: 0%</span>
      <span id="res-scrap" class="resource hidden">废铁: 0</span>
    </div>

    <div id="log-container">
      <div class="log-entry">系统离线... 等待手动指令...</div>
    </div>

    <div id="controls"></div>

    <script>
      // --- 1. 游戏状态 (数据层) ---
      const gameState = {
        resources: {
          power: 0,
          scrap: 0,
        },
        flags: {
          systemRebooted: false,
          lightsOn: false,
        },
      };

      // --- 2. 游戏配置 (动作定义) ---
      // 这里定义所有的按钮及其逻辑
      const actions = [
        {
          id: "crank",
          label: "[ 手动摇杆 ]",
          class: "btn-full", // 样式类
          isVisible: () => true, // 始终可见
          isEnabled: () => gameState.resources.power < 100, // 电力满了就不能点了
          effect: () => {
            gameState.resources.power += 5;
            if (gameState.resources.power > 100)
              gameState.resources.power = 100;

            // 随机文本增加趣味性
            const msgs = [
              "转轴发出刺耳的摩擦声。",
              "你用力摇动，仪表盘闪烁了一下。",
              "体力在流失，但电力在增加。",
            ];
            log(msgs[Math.floor(Math.random() * msgs.length)]);

            checkTriggers(); // 检查是否触发了剧情
          },
        },
        {
          id: "scavenge",
          label: "搜索残骸 (-10 电力)",
          isVisible: () => gameState.flags.systemRebooted, // 重启后才显示
          isEnabled: () => gameState.resources.power >= 10,
          effect: () => {
            gameState.resources.power -= 10;
            gameState.resources.scrap += 1;
            log("你在黑暗中摸索，找到了一块可用的金属片。");
          },
        },
        {
          id: "repair_lights",
          label: "修复照明系统 (-3 废铁)",
          isVisible: () =>
            gameState.resources.scrap >= 1 && !gameState.flags.lightsOn,
          isEnabled: () => gameState.resources.scrap >= 3,
          effect: () => {
            gameState.resources.scrap -= 3;
            gameState.flags.lightsOn = true;
            log(
              "滋... 滋... 灯光亮起。你看清了周围：这是一艘损毁严重的潜水艇。"
            );
            document.body.style.backgroundColor = "#0a1a2a"; // 改变背景色暗示环境变化
          },
        },
      ];

      // --- 3. 核心功能函数 ---

      // 添加日志
      function log(text) {
        const container = document.getElementById("log-container");
        const entry = document.createElement("div");
        entry.className = "log-entry new";
        entry.innerText = `> ${text}`;

        // 插入到最上面 (类似于 A Dark Room)
        container.prepend(entry);

        // 保持日志数量不要太多，防止卡顿
        if (container.children.length > 50) {
          container.removeChild(container.lastChild);
        }
      }

      // 触发器检查 (剧情推进逻辑)
      function checkTriggers() {
        // 第一次电力到达 20，系统重启
        if (
          gameState.resources.power >= 20 &&
          !gameState.flags.systemRebooted
        ) {
          gameState.flags.systemRebooted = true;
          log("警告：主系统重启完成。检测到船体多处破损。");
          document.getElementById("res-power").classList.remove("hidden");
          document.getElementById("res-scrap").classList.remove("hidden");
          renderButtons(); // 重新渲染按钮以显示新解锁的功能
        }
      }

      // 渲染界面
      function render() {
        // 更新资源显示
        document.getElementById(
          "res-power"
        ).innerText = `电力: ${gameState.resources.power}%`;
        document.getElementById(
          "res-scrap"
        ).innerText = `废铁: ${gameState.resources.scrap}`;

        // 更新按钮状态 (是否禁用)
        actions.forEach((action) => {
          const btn = document.getElementById(`btn-${action.id}`);
          if (btn) {
            btn.disabled = !action.isEnabled();
            // 如果按钮之前是隐藏的，现在条件满足了，可能需要重新渲染整个按钮列表
            // 为了简化MVP，这里主要处理disabled状态
          }
        });
      }

      // 渲染按钮列表 (通常在解锁新功能时调用)
      function renderButtons() {
        const container = document.getElementById("controls");
        container.innerHTML = ""; // 清空现有按钮

        actions.forEach((action) => {
          if (action.isVisible()) {
            const btn = document.createElement("button");
            btn.id = `btn-${action.id}`;
            btn.innerText = action.label;
            if (action.class) btn.className = action.class;
            btn.disabled = !action.isEnabled();

            btn.onclick = () => {
              action.effect();
              render(); // 点击后刷新数值
              renderButtons(); // 某些点击可能导致按钮消失或出现，粗暴重绘
            };

            container.appendChild(btn);
          }
        });
      }

      // --- 4. 启动游戏 ---
      function init() {
        log("系统自检失败...");
        log("备用电源离线...");
        renderButtons();
        render();
      }

      // 启动
      init();
    </script>
  </body>
</html>
